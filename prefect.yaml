name: market-data-ingestion
prefect-version: 2.0

build:
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker
      image_name: "{{ env.ARTIFACT_REGISTRY }}/{{ env.GCP_PROJECT_ID }}/{{ env.REPOSITORY }}/{{ env.IMAGE_NAME }}"
      tag: latest

push:
  - prefect_docker.deployments.steps.push_docker_image:
      requires: prefect-docker
      image_name: "{{ build-image.image_name }}"
      tag: "{{ build-image.tag }}"

pull:
  - prefect_docker.images.pull_docker_image:
      image: ${{ env.ARTIFACT_REGISTRY }}/${{ env.GCP_PROJECT_ID }}/${{ env.REPOSITORY }}/${{ env.IMAGE_NAME }}:latest

deployments:
  - name: market-data-ingestion
    version: 0.1.0
    tags: ["production", "market-data", "ingestion"]
    description: Market data ingestion flow for quanterra pipeline
    schedule: null
    flow_name: market_data_ingestion
    entrypoint: src/flows/ingestion.py:market_data_ingestion_flow
    work_pool:
      name: docker-pool
      work_queue_name: default
    parameters: {} 